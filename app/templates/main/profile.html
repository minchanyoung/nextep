{% extends "base.html" %}

{% block title %}프로필{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/predict.css') }}"> {# predict.css를 추가하여 스타일을 공유 #}
{% endblock %}

{% block content %}
<div class="form-wrapper predict-wrapper">
    <form method="POST" action="{{ url_for('main.profile') }}" class="predict-form">
        <h1>내 프로필</h1>
        <p class="subtitle">
            회원님의 정보를 최신 상태로 유지하여 맞춤형 서비스를 경험하세요.
        </p>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flashes">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div class="form-grid">
            <div class="form-group">
                <label for="username">사용자 이름</label>
                <input type="text" id="username" name="username" value="{{ user.username }}" readonly>
            </div>
            <div class="form-group">
                <label for="email">이메일</label>
                <input type="email" id="email" name="email" value="{{ user.email }}" readonly>
            </div>
            <div class="form-group">
                <label for="age">나이</label>
                <input type="number" id="age" name="age" placeholder="예: 30" value="{{ user.age if user.age is not none else '' }}">
            </div>
            <div class="form-group">
                <label>성별</label>
                <div class="gender-buttons">
                    <button type="button" class="gender-btn {% if user.gender == 0 %}active{% endif %}" data-value="0">남성</button>
                    <button type="button" class="gender-btn {% if user.gender == 1 %}active{% endif %}" data-value="1">여성</button>
                    <input type="hidden" id="gender" name="gender" value="{{ user.gender if user.gender is not none else '' }}">
                </div>
            </div>
            <div class="form-group">
                <label for="education">최종 학력</label>
                <select id="education" name="education">
                    <option value="" disabled {% if user.education is none %}selected{% endif %}>선택해주세요</option>
                    <option value="6" {% if user.education == 6 %}selected{% endif %}>대학교 졸업 이상</option>
                    <option value="5" {% if user.education == 5 %}selected{% endif %}>전문대 졸업</option>
                    <option value="4" {% if user.education == 4 %}selected{% endif %}>대재 또는 중퇴</option>
                    <option value="3" {% if user.education == 3 %}selected{% endif %}>고졸</option>
                    <option value="2" {% if user.education == 2 %}selected{% endif %}>고졸 미만</option>
                    <option value="1" {% if user.education == 1 %}selected{% endif %}>무학 또는 초중퇴</option>
                </select>
            </div>
            <div class="form-group">
                <label for="monthly_income">현재 월 소득 (만원)</label>
                <input type="number" id="monthly_income" name="monthly_income" placeholder="예: 300" value="{{ user.monthly_income if user.monthly_income is not none else '' }}">
            </div>
            <div class="form-group full-width">
                <label for="job_category">현재 직업군</label>
                <select id="job_category" name="job_category">
                    <option value="" disabled {% if user.job_category is none %}selected{% endif %}>선택해주세요</option>
                    <option value="1" {% if user.job_category == 1 %}selected{% endif %}>관리자</option>
                    <option value="2" {% if user.job_category == 2 %}selected{% endif %}>전문가 및 관련 종사자</option>
                    <option value="3" {% if user.job_category == 3 %}selected{% endif %}>사무 종사자</option>
                    <option value="4" {% if user.job_category == 4 %}selected{% endif %}>서비스 종사자</option>
                    <option value="5" {% if user.job_category == 5 %}selected{% endif %}>판매 종사자</option>
                    <option value="6" {% if user.job_category == 6 %}selected{% endif %}>농림 어업 숙련 종사자</option>
                    <option value="7" {% if user.job_category == 7 %}selected{% endif %}>기능원 및 관련 기능 종사자</option>
                    <option value="8" {% if user.job_category == 8 %}selected{% endif %}>장치·기계조작 및 조립 종사자</option>
                    <option value="9" {% if user.job_category == 9 %}selected{% endif %}>단순 노무 종사자</option>
                </select>
            </div>
            <div class="form-group full-width">
                <label>현재 직무 만족도 (5점 만점)</label>
                <div class="satisfaction-group">
                    <input type="radio" id="satis1" name="job_satisfaction" value="1" {% if user.job_satisfaction == 1 %}checked{% endif %}>
                    <label for="satis1">1점</label>
                    <input type="radio" id="satis2" name="job_satisfaction" value="2" {% if user.job_satisfaction == 2 %}checked{% endif %}>
                    <label for="satis2">2점</label>
                    <input type="radio" id="satis3" name="job_satisfaction" value="3" {% if user.job_satisfaction == 3 %}checked{% endif %}>
                    <label for="satis3">3점</label>
                    <input type="radio" id="satis4" name="job_satisfaction" value="4" {% if user.job_satisfaction == 4 %}checked{% endif %}>
                    <label for="satis4">4점</label>
                    <input type="radio" id="satis5" name="job_satisfaction" value="5" {% if user.job_satisfaction == 5 %}checked{% endif %}>
                    <label for="satis5">5점</label>
                </div>
            </div>
            <div class="form-group full-width">
                <label>각 요인별 현재 만족도를 평가해주세요 (1: 매우 불만족 ~ 5: 매우 만족)</label>
                <div class="satisfaction-factors-grid">
                    <div class="satisfaction-factor">
                        <label for="satisWageProfile">임금 또는 보수</label>
                        <div class="slider-container">
                            <input type="range" id="satisWageProfile" name="satis_wage" min="1" max="5" value="{{ user.satis_wage or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisWageProfileValue">{{ user.satis_wage or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisStabilityProfile">고용 안정성</label>
                        <div class="slider-container">
                            <input type="range" id="satisStabilityProfile" name="satis_stability" min="1" max="5" value="{{ user.satis_stability or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisStabilityProfileValue">{{ user.satis_stability or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisGrowthProfile">발전 가능성</label>
                        <div class="slider-container">
                            <input type="range" id="satisGrowthProfile" name="satis_growth" min="1" max="5" value="{{ user.satis_growth or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisGrowthProfileValue">{{ user.satis_growth or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisTaskContentProfile">일의 내용</label>
                        <div class="slider-container">
                            <input type="range" id="satisTaskContentProfile" name="satis_task_content" min="1" max="5" value="{{ user.satis_task_content or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisTaskContentProfileValue">{{ user.satis_task_content or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisWorkEnvProfile">근무 환경</label>
                        <div class="slider-container">
                            <input type="range" id="satisWorkEnvProfile" name="satis_work_env" min="1" max="5" value="{{ user.satis_work_env or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisWorkEnvProfileValue">{{ user.satis_work_env or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisWorkTimeProfile">근무 시간과 여가</label>
                        <div class="slider-container">
                            <input type="range" id="satisWorkTimeProfile" name="satis_work_time" min="1" max="5" value="{{ user.satis_work_time or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisWorkTimeProfileValue">{{ user.satis_work_time or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisCommunicationProfile">인간 관계</label>
                        <div class="slider-container">
                            <input type="range" id="satisCommunicationProfile" name="satis_communication" min="1" max="5" value="{{ user.satis_communication or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisCommunicationProfileValue">{{ user.satis_communication or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisFairEvalProfile">공정한 평가와 보상</label>
                        <div class="slider-container">
                            <input type="range" id="satisFairEvalProfile" name="satis_fair_eval" min="1" max="5" value="{{ user.satis_fair_eval or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisFairEvalProfileValue">{{ user.satis_fair_eval or 3 }}</div>
                        </div>
                    </div>
                    
                    <div class="satisfaction-factor">
                        <label for="satisWelfareProfile">복리 후생</label>
                        <div class="slider-container">
                            <input type="range" id="satisWelfareProfile" name="satis_welfare" min="1" max="5" value="{{ user.satis_welfare or 3 }}" class="satisfaction-slider">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                            <div class="slider-value" id="satisWelfareProfileValue">{{ user.satis_welfare or 3 }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">프로필 업데이트</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/predict.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 성별 버튼 처리
            const genderButtons = document.querySelectorAll('.gender-btn');
            const genderInput = document.getElementById('gender');

            genderButtons.forEach(button => {
                button.addEventListener('click', function() {
                    genderButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    genderInput.value = this.dataset.value;
                });
            });

            // 페이지 로드 시 현재 선택된 성별 버튼 활성화
            if (genderInput.value !== '') {
                const selectedButton = document.querySelector(`.gender-btn[data-value="${genderInput.value}"]`);
                if (selectedButton) {
                    selectedButton.classList.add('active');
                }
            }

            // 만족도 슬라이더 처리
            document.querySelectorAll('.satisfaction-slider').forEach(slider => {
                const valueDisplay = document.getElementById(slider.id + 'Value');
                
                // 값 변경 이벤트
                slider.addEventListener('input', () => {
                    valueDisplay.textContent = slider.value;
                });
            });
        });
    </script>
{% endblock %}